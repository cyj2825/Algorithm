SELECT DISTINCT A.CAR_ID, A.CAR_TYPE, FLOOR(30*A.DAILY_FEE*(1-C.DISCOUNT_RATE*0.01)) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A LEFT JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY B ON A.CAR_ID = B.CAR_ID LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN C ON A.CAR_TYPE = C.CAR_TYPE
WHERE A.CAR_TYPE IN ('세단', 'SUV') and (A.CAR_ID NOT IN (SELECT CAR_ID FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY WHERE '2022-11' BETWEEN date_format(START_DATE, '%Y-%m') AND date_format(END_DATE, '%Y-%m'))) and (C.DURATION_TYPE = '30일 이상' and (30*A.DAILY_FEE*(1-C.DISCOUNT_RATE*0.01)) BETWEEN 500000 AND 2000000)
ORDER BY FEE DESC, A.CAR_TYPE, A.CAR_ID DESC